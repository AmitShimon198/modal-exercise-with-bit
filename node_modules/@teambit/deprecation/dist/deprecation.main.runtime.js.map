{"version":3,"sources":["deprecation.main.runtime.ts"],"names":["DeprecationMain","constructor","scope","getDeprecationInfo","component","deprecated","state","_consumer","isDeprecate","deprecate","ids","results","path","clearCache","unDeprecate","provider","graphql","componentAspect","deprecation","registerShowFragments","DeprecationFragment","register","MainRuntime","GraphqlAspect","ScopeAspect","ComponentAspect","DeprecationAspect","addRuntime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAMO,MAAMA,eAAN,CAAsB;AAC3BC,EAAAA,WAAW,CAASC,KAAT,EAA2B;AAAA,SAAlBA,KAAkB,GAAlBA,KAAkB;AAAE;;AAIxCC,EAAAA,kBAAkB,CAACC,SAAD,EAAwC;AACxD,UAAMC,UAAU,GAAGD,SAAS,CAACE,KAAV,CAAgBC,SAAhB,CAA0BF,UAA7C;AACA,UAAMG,WAAW,GAAG,CAAC,CAACH,UAAtB;AACA,WAAO;AACLG,MAAAA;AADK,KAAP;AAGD;;AAEc,QAATC,SAAS,CAACC,GAAD,EAAgB;AAC7B,UAAMC,OAAO,GAAG,MAAM,wBAAU;AAAEC,MAAAA,IAAI,EAAE,KAAKV,KAAL,CAAWU,IAAnB;AAAyBF,MAAAA;AAAzB,KAAV,EAA0C,IAA1C,CAAtB;AACA,SAAKR,KAAL,CAAWW,UAAX;AACA,WAAOF,OAAP;AACD;;AAEgB,QAAXG,WAAW,CAACJ,GAAD,EAAgB;AAC/B,UAAMC,OAAO,GAAG,0BAAY;AAAEC,MAAAA,IAAI,EAAE,KAAKV,KAAL,CAAWU,IAAnB;AAAyBF,MAAAA;AAAzB,KAAZ,EAA4C,IAA5C,CAAhB;AACA,SAAKR,KAAL,CAAWW,UAAX;AACA,WAAOF,OAAP;AACD;;AAEoB,eAARI,QAAQ,CAAC,CAACC,OAAD,EAAUd,KAAV,EAAiBe,eAAjB,CAAD,EAA6E;AAChG,UAAMC,WAAW,GAAG,IAAIlB,eAAJ,CAAoBE,KAApB,CAApB;AACAe,IAAAA,eAAe,CAACE,qBAAhB,CAAsC,CAAC,KAAIC,mCAAJ,EAAwBF,WAAxB,CAAD,CAAtC;AACAF,IAAAA,OAAO,CAACK,QAAR,CAAiB,uCAAkBH,WAAlB,CAAjB;AACD;;AA7B0B;;;gCAAhBlB,e,aAEMsB,kB;gCAFNtB,e,kBAGW,CAACuB,wBAAD,EAAgBC,qBAAhB,EAA6BC,4BAA7B,C;;AA6BxBC,iCAAkBC,UAAlB,CAA6B3B,eAA7B","sourcesContent":["import { deprecate, undeprecate } from '@teambit/legacy/dist/api/scope';\nimport { MainRuntime } from '@teambit/cli';\nimport { ComponentMain, ComponentAspect, Component } from '@teambit/component';\nimport { ScopeMain, ScopeAspect } from '@teambit/scope';\nimport { GraphqlAspect, GraphqlMain } from '@teambit/graphql';\nimport { DeprecationAspect } from './deprecation.aspect';\nimport { deprecationSchema } from './deprecation.graphql';\nimport { DeprecationFragment } from './deprecation.fragment';\n\nexport type DeprecationInfo = {\n  isDeprecate: boolean;\n};\n\nexport class DeprecationMain {\n  constructor(private scope: ScopeMain) {}\n  static runtime = MainRuntime;\n  static dependencies = [GraphqlAspect, ScopeAspect, ComponentAspect];\n\n  getDeprecationInfo(component: Component): DeprecationInfo {\n    const deprecated = component.state._consumer.deprecated;\n    const isDeprecate = !!deprecated;\n    return {\n      isDeprecate,\n    };\n  }\n\n  async deprecate(ids: string[]) {\n    const results = await deprecate({ path: this.scope.path, ids }, null);\n    this.scope.clearCache();\n    return results;\n  }\n\n  async unDeprecate(ids: string[]) {\n    const results = undeprecate({ path: this.scope.path, ids }, null);\n    this.scope.clearCache();\n    return results;\n  }\n\n  static async provider([graphql, scope, componentAspect]: [GraphqlMain, ScopeMain, ComponentMain]) {\n    const deprecation = new DeprecationMain(scope);\n    componentAspect.registerShowFragments([new DeprecationFragment(deprecation)]);\n    graphql.register(deprecationSchema(deprecation));\n  }\n}\n\nDeprecationAspect.addRuntime(DeprecationMain);\n"]}