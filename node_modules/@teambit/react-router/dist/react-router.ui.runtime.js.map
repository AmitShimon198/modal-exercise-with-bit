{"version":3,"sources":["react-router.ui.runtime.tsx"],"names":["ReactRouterUI","constructor","routeSlot","routeChangeListener","isBrowser","Routing","url","static","undefined","routerHistory","unregisterListener","listen","args","values","forEach","listener","path","action","legacyNavigateTo","replace","push","state","renderRoutes","routes","options","routingMode","initialLocation","setRoutingMode","routing","register","route","registerListener","provider","deps","config","routeChangeSlot","Slot","withType","UIRuntime","ReactRouterAspect","addRuntime"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { RouteProps } from 'react-router-dom';\nimport { History, UnregisterCallback, LocationListener, LocationDescriptor, Action } from 'history';\nimport { Slot, SlotRegistry } from '@teambit/harmony';\nimport { UIRuntime } from '@teambit/ui';\nimport { RouteSlot } from '@teambit/ui-foundation.ui.react-router.slot-router';\nimport { isBrowser } from '@teambit/ui-foundation.ui.is-browser';\n\nimport { ReactRouterAspect } from './react-router.aspect';\nimport { RouteContext, RootRoute } from './route-context';\nimport { Routing } from './routing-method';\n\ntype RouteChangeSlot = SlotRegistry<LocationListener>;\ntype RenderRoutesOptions = {\n  initialLocation?: string;\n};\n\nexport class ReactRouterUI {\n  private routerHistory?: History;\n  private routingMode = isBrowser ? Routing.url : Routing.static;\n\n  constructor(\n    /**\n     * route slot.\n     */\n    private routeSlot: RouteSlot,\n    /**\n     *\n     */\n    private routeChangeListener: RouteChangeSlot\n  ) {}\n\n  /**\n   * render all slot routes.\n   */\n  renderRoutes(routes: RouteProps[], options: RenderRoutesOptions = {}): JSX.Element {\n    return (\n      <RouteContext reactRouterUi={this} routing={this.routingMode} location={options.initialLocation}>\n        <RootRoute routeSlot={this.routeSlot} rootRoutes={routes}></RootRoute>\n      </RouteContext>\n    );\n  }\n\n  private unregisterListener?: UnregisterCallback = undefined;\n  /** (internal method) sets the routing engine for navigation methods */\n  setRouter = (routerHistory: History) => {\n    this.routerHistory = routerHistory;\n\n    this.unregisterListener?.();\n    this.unregisterListener = routerHistory.listen((...args) => {\n      this.routeChangeListener.values().forEach((listener) => listener(...args));\n    });\n  };\n\n  /** decides how navigation is stored and applied.\n   * Url - updates the `window.location.pathname`.\n   * Hash - updates `window.location.hash`.\n   * InMemory - store state internally and don't update the browser.\n   */\n  setRoutingMode(routing: Routing) {\n    this.routingMode = routing;\n  }\n\n  /**\n   * register a new route.\n   */\n  register(route: RouteProps) {\n    this.routeSlot.register(route);\n    return this;\n  }\n\n  registerListener(listener: LocationListener) {\n    this.routeChangeListener.register(listener);\n  }\n\n  /**\n   * change browser location\n   */\n  navigateTo = (\n    /** destination */\n    path: LocationDescriptor,\n    /**\n     * type of history action to execute (pop / push / replace).\n     * Supports state-object for legacy calls. (this will be removed when supported by symphony)\n     */\n    action?: Action | Record<string, any>\n  ) => {\n    if (typeof action !== 'string') {\n      this.legacyNavigateTo(path as string, action);\n      return;\n    }\n\n    switch (action) {\n      case 'POP':\n        return; // TBD;\n      case 'REPLACE':\n        this.routerHistory?.replace(path);\n        return;\n      case 'PUSH':\n      default:\n        this.routerHistory?.push(path);\n    }\n  };\n\n  /**\n   * change browser location\n   */\n  private legacyNavigateTo = (\n    /** destination */\n    path: string,\n    state?: Record<string, any>\n  ) => {\n    this.routerHistory?.push(path, state);\n  };\n\n  static slots = [Slot.withType<RouteProps>(), Slot.withType<LocationListener>()];\n  static runtime = UIRuntime;\n\n  static async provider(deps, config, [routeSlot, routeChangeSlot]: [RouteSlot, RouteChangeSlot]) {\n    return new ReactRouterUI(routeSlot, routeChangeSlot);\n  }\n}\n\nReactRouterAspect.addRuntime(ReactRouterUI);\n"]}